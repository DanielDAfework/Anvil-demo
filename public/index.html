<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>California Standard Residential Lease Agreement</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }

        html {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100%;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .form-container {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .name-group {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            gap: 15px;
        }

        .address-group {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
        }

        .amount-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .submit-section {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            margin-left: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 20px;
            }
            
            .name-group, .address-group {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>California Standard Residential Lease Agreement</h1>
            <p>Fill out the form below to generate your lease agreement PDF</p>
        </div>

        <div class="form-container">
            <div id="alert" class="alert"></div>

            <form id="leaseForm">
                <!-- Agreement Information -->
                <div class="form-section">
                    <h2 class="section-title">Agreement Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="agreementDate">Agreement Date *</label>
                            <input type="date" id="agreementDate" name="agreementDate" required>
                        </div>
                    </div>
                </div>

                <!-- Landlord Information -->
                <div class="form-section">
                    <h2 class="section-title">Landlord Information</h2>
                    <div class="name-group">
                        <div class="form-group">
                            <label for="landlordFirstName">First Name *</label>
                            <input type="text" id="landlordFirstName" name="landlordFirstName" required>
                        </div>
                        <div class="form-group">
                            <label for="landlordMI">Middle Initial</label>
                            <input type="text" id="landlordMI" name="landlordMI" maxlength="1">
                        </div>
                        <div class="form-group">
                            <label for="landlordLastName">Last Name *</label>
                            <input type="text" id="landlordLastName" name="landlordLastName" required>
                        </div>
                    </div>
                </div>

                <!-- Tenant Information -->
                <div class="form-section">
                    <h2 class="section-title">Tenant Information</h2>
                    <div class="name-group">
                        <div class="form-group">
                            <label for="tenantFirstName">First Name *</label>
                            <input type="text" id="tenantFirstName" name="tenantFirstName" required>
                        </div>
                        <div class="form-group">
                            <label for="tenantMI">Middle Initial</label>
                            <input type="text" id="tenantMI" name="tenantMI" maxlength="1">
                        </div>
                        <div class="form-group">
                            <label for="tenantLastName">Last Name *</label>
                            <input type="text" id="tenantLastName" name="tenantLastName" required>
                        </div>
                    </div>
                </div>

                <!-- Property Address -->
                <div class="form-section">
                    <h2 class="section-title">Property Address</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="propertyStreet1">Street Address *</label>
                            <input type="text" id="propertyStreet1" name="propertyStreet1" required>
                        </div>
                        <div class="form-group">
                            <label for="propertyStreet2">Street Address 2</label>
                            <input type="text" id="propertyStreet2" name="propertyStreet2">
                        </div>
                        <div class="form-group">
                            <label for="propertyCity">City *</label>
                            <input type="text" id="propertyCity" name="propertyCity" required>
                        </div>
                        <div class="form-group">
                            <label for="propertyState">State *</label>
                            <select id="propertyState" name="propertyState" required>
                                <option value="">Select State</option>
                                <option value="CA">California</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="propertyZip">ZIP Code *</label>
                            <input type="text" id="propertyZip" name="propertyZip" required>
                        </div>
                        <div class="form-group">
                            <label for="propertyCountry">Country *</label>
                            <input type="text" id="propertyCountry" name="propertyCountry" value="US" required disabled="true">
                        </div>
                    </div>
                </div>

                <!-- Lease Dates -->
                <div class="form-section">
                    <h2 class="section-title">Lease Dates</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="leaseStartDate">Lease Start Date *</label>
                            <input type="date" id="leaseStartDate" name="leaseStartDate" required>
                        </div>
                        <div class="form-group">
                            <label for="leaseEndDate">Lease End Date *</label>
                            <input type="date" id="leaseEndDate" name="leaseEndDate" required>
                        </div>
                    </div>
                </div>

                <!-- Financial Information -->
                <div class="form-section">
                    <h2 class="section-title">Financial Information</h2>
                    <div class="amount-group">
                        <div class="form-group">
                            <label for="monthlyRentAmount">Monthly Rent Amount *</label>
                            <input type="number" id="monthlyRentAmount" name="monthlyRentAmount" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="lateFeeAmount">Late Fee Amount *</label>
                            <input type="number" id="lateFeeAmount" name="lateFeeAmount" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="returnedCheckFee">Returned Check Fee *</label>
                            <input type="number" id="returnedCheckFee" name="returnedCheckFee" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="securityDepositAmount">Security Deposit Amount *</label>
                            <input type="number" id="securityDepositAmount" name="securityDepositAmount" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="tenantsHoldOverRentAmount">Hold Over Rent Amount *</label>
                            <input type="number" id="tenantsHoldOverRentAmount" name="tenantsHoldOverRentAmount" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="animalFee">Animal Fee *</label>
                            <input type="number" id="animalFee" name="animalFee" step="0.01" min="0" required>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="form-section">
                    <h2 class="section-title">Additional Information</h2>
                    <div class="form-group full-width">
                        <label for="tenantsImmediateFamilyMembers">Tenant's Immediate Family Members</label>
                        <textarea id="tenantsImmediateFamilyMembers" name="tenantsImmediateFamilyMembers" rows="3" placeholder="List any immediate family members who will be living in the property..."></textarea>
                    </div>
                </div>

                <!-- Notice Address -->
                <div class="form-section">
                    <h2 class="section-title">Notice Address</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="noticeStreet1">Street Address *</label>
                            <input type="text" id="noticeStreet1" name="noticeStreet1" required>
                        </div>
                        <div class="form-group">
                            <label for="noticeStreet2">Street Address 2</label>
                            <input type="text" id="noticeStreet2" name="noticeStreet2">
                        </div>
                        <div class="form-group">
                            <label for="noticeCity">City *</label>
                            <input type="text" id="noticeCity" name="noticeCity" required>
                        </div>
                        <div class="form-group">
                            <label for="noticeState">State *</label>
                            <select id="noticeState" name="noticeState" required>
                                <option value="">Select State</option>
                                <option value="CA">California</option>
                                <option value="NY">New York</option>
                                <option value="TX">Texas</option>
                                <option value="FL">Florida</option>
                                <option value="IL">Illinois</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="OH">Ohio</option>
                                <option value="GA">Georgia</option>
                                <option value="NC">North Carolina</option>
                                <option value="MI">Michigan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="noticeZip">ZIP Code *</label>
                            <input type="text" id="noticeZip" name="noticeZip" required>
                        </div>
                        <div class="form-group">
                            <label for="noticeCountry">Country *</label>
                            <input type="text" id="noticeCountry" name="noticeCountry" value="US" required>
                        </div>
                    </div>
                </div>

                <div class="submit-section">
                    <button type="submit" class="submit-btn" id="submitBtn">
                        Generate PDF
                        <span class="loading" id="loading">⏳</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Get form elements
        const form = document.getElementById('leaseForm');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const alert = document.getElementById('alert');

        // List of required field IDs
        const requiredFields = [
            'agreementDate',
            'landlordFirstName',
            'landlordLastName',
            'tenantFirstName',
            'tenantLastName',
            'propertyStreet1',
            'propertyCity',
            'propertyState',
            'propertyZip',
            'propertyCountry',
            'leaseStartDate',
            'leaseEndDate',
            'monthlyRentAmount',
            'lateFeeAmount',
            'returnedCheckFee',
            'securityDepositAmount',
            'tenantsHoldOverRentAmount',
            'animalFee',
            'noticeStreet1',
            'noticeCity',
            'noticeState',
            'noticeZip',
            'noticeCountry'
        ];

        // Function to check if all required fields are filled
        function validateForm() {
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    isValid = false;
                }
            });

            // Additional validation for numeric fields
            const numericFields = [
                'monthlyRentAmount',
                'lateFeeAmount',
                'returnedCheckFee',
                'securityDepositAmount',
                'tenantsHoldOverRentAmount',
                'animalFee'
            ];

            numericFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && (isNaN(parseFloat(field.value)) || parseFloat(field.value) < 0)) {
                    isValid = false;
                }
            });

            // Update button state
            submitBtn.disabled = !isValid;
            
            // Update button text based on validation
            if (isValid) {
                submitBtn.textContent = 'Generate PDF';
            } else {
                submitBtn.textContent = 'Please fill all required fields';
            }
        }

        // Add event listeners to all form fields
        function addValidationListeners() {
            const allFields = form.querySelectorAll('input, select, textarea');
            
            allFields.forEach(field => {
                field.addEventListener('input', validateForm);
                field.addEventListener('change', validateForm);
                field.addEventListener('blur', validateForm);
            });
        }

        // Initialize validation
        addValidationListeners();
        validateForm(); // Initial validation

        // Form submission handler
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Double-check validation before submitting
            if (submitBtn.disabled) {
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            loading.style.display = 'inline';
            alert.style.display = 'none';
            
            try {
                // Collect form data
                const formData = new FormData(this);
                
                // Function to format date to YYYY-MM-DD format
                function formatDateToYYYY(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                }
                
                // Function to extract date components
                function extractDateComponents(dateString) {
                    if (!dateString) return { month: '', day: '', year: '' };
                    const date = new Date(dateString);
                    return {
                        month: String(date.getMonth() + 1).padStart(2, '0'),
                        day: String(date.getDate()).padStart(2, '0'),
                        year: String(date.getFullYear()).slice(-2) // Get last 2 digits
                    };
                }
                
                // Extract agreement date components
                const agreementDateComponents = extractDateComponents(formData.get('agreementDate'));
                
                const payload = {
                    "title": "California Standard Residential Lease Agreement Form",
                    "data": {
                        "agreementDate": formatDateToYYYY(formData.get('agreementDate')),
                        "agreementMonth": agreementDateComponents.month,
                        "agreementDay": agreementDateComponents.day,
                        "agreementYear": agreementDateComponents.year,
                        "landlordName": {
                            "firstName": formData.get('landlordFirstName'),
                            "mi": formData.get('landlordMI'),
                            "lastName": formData.get('landlordLastName')
                        },
                        "tenantName": {
                            "firstName": formData.get('tenantFirstName'),
                            "mi": formData.get('tenantMI'),
                            "lastName": formData.get('tenantLastName')
                        },
                        "propertyAddress": {
                            "street1": formData.get('propertyStreet1'),
                            "street2": formData.get('propertyStreet2'),
                            "city": formData.get('propertyCity'),
                            "state": formData.get('propertyState'),
                            "zip": formData.get('propertyZip'),
                            "country": formData.get('propertyCountry')
                        },
                        "leaseStartDate": formatDateToYYYY(formData.get('leaseStartDate')),
                        "leaseEndDate": formatDateToYYYY(formData.get('leaseEndDate')),
                        "monthlyRentAmount": parseFloat(formData.get('monthlyRentAmount')),
                        "lateFeeAmount": parseFloat(formData.get('lateFeeAmount')),
                        "returnedCheckFee": parseFloat(formData.get('returnedCheckFee')),
                        "securityDepositAmount": parseFloat(formData.get('securityDepositAmount')),
                        "tenantsImmediateFamilyMembers": formData.get('tenantsImmediateFamilyMembers'),
                        "tenantsHoldOverRentAmount": parseFloat(formData.get('tenantsHoldOverRentAmount')),
                        "animalFee": parseFloat(formData.get('animalFee')),
                        "noticeAddress": {
                            "street1": formData.get('noticeStreet1'),
                            "street2": formData.get('noticeStreet2'),
                            "city": formData.get('noticeCity'),
                            "state": formData.get('noticeState'),
                            "zip": formData.get('noticeZip'),
                            "country": formData.get('noticeCountry')
                        }
                    }
                };

                // Send to server
                const response = await fetch('/save-pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    // Create blob and download
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'lease_agreement.pdf';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    // Show success message
                    alert.className = 'alert success';
                    alert.textContent = 'PDF generated successfully! Download started.';
                    alert.style.display = 'block';
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to generate PDF');
                }
                
            } catch (error) {
                console.error('Error:', error);
                alert.className = 'alert error';
                alert.textContent = `Error: ${error.message}`;
                alert.style.display = 'block';
            } finally {
                // Reset loading state and re-validate
                validateForm();
                loading.style.display = 'none';
            }
        });

        // Set default dates
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('agreementDate').value = today;
        
        // Set default end date to 1 year from today
        const oneYearFromNow = new Date();
        oneYearFromNow.setFullYear(oneYearFromNow.getFullYear() + 1);
        document.getElementById('leaseEndDate').value = oneYearFromNow.toISOString().split('T')[0];
        
        // Re-validate after setting default dates
        setTimeout(validateForm, 100);
    </script>
</body>
</html>
